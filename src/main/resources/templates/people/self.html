<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>Users</title>

  <link rel="stylesheet" href="/css/main.css" type="text/css"/>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"
          integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf"
          crossorigin="anonymous"></script>
</head>
<body class="mt-3">
<div class="container">

  <div class="btn-group">

    <div class="title">
      Bugtracker
    </div>

    <div th:if="${#strings.contains(#authentication.getPrincipal().authorities, 'ROLE_MANAGE_PROJECT')}"
         class="col mt-3">
      <a th:href="@{'/issues'}" class="btn btn-primary">
        <h7 th:text="#{issues}"></h7>
      </a>
    </div>

    <div th:if="${#strings.contains(#authentication.getPrincipal().authorities, 'ROLE_MANAGE_PROJECT')}"
         class="col mt-3">
      <a th:href="@{'/projects'}" class="btn btn-primary">
        <h7 th:text="#{projects}"></h7>
      </a>
    </div>

    <div th:if="${#strings.contains(#authentication.getPrincipal().authorities, 'USER')}"
         class="col mt-3">
      <a th:href="@{'/people/'}" class="btn btn-primary">
        <h7 th:text="#{users}"></h7>
      </a>
    </div>

    <div class="col-6 mt-3">
      <a th:href="@{'/people/edit/self'}" class="btn btn-dark">
        <h7 th:text="#{my.account}"></h7>
      </a>
    </div>

    <div class="col-3 mt-3 text-end">
      <a th:text="#{logged.in.user} + ': ' +${#authentication.getPrincipal().username}"></a>
      <form th:action="@{/logout}" method="post" class="form-inline mt-3">
        <input type="submit" th:value="#{log.out}" class="btn btn-success"/>
      </form>
    </div>
  </div>

  <h2 th:if="${person.id == null}" th:text="#{new.user}">
  </h2>

  <h2 th:if="${person.id != null}" th:text="#{user.edit}">
    <span th:text="${userRealName}"></span>
  </h2>



  <form th:action="@{/people/save}" th:object="${person}" method="post">
    <input type="hidden" th:field="*{id}">
    <div class="row">
      <div>
        <label for="username">
          <h7 th:text="#{username}"></h7>
        </label>
      </div>

      <div>
        <input type="text"
               id="username"
               th:field="*{username}"
               class="form-control">
      </div>
    </div>

    <div class="row">
      <div>
        <label for="password">
          <h7 th:text="#{password}"></h7>
        </label>
      </div>

      <div>
        <input type="text"
               id="password"
               th:field="*{password}"
               class="form-control">
      </div>
    </div>

    <div class="row">
      <div>
        <label for="userRealName">
          <h7 th:text="#{userRealName}"></h7>
        </label>
      </div>

      <div>
        <input type="text"
               id="userRealName"
               th:field="*{userRealName}"
               class="form-control">
      </div>
    </div>

    <div class="row">
      <div>
        <label for="email">
          <h7 th:text="E-mail"></h7>
        </label>
      </div>

      <div>
        <input type="text"
               id="email"
               th:field="*{email}"
               class="form-control">
      </div>
    </div>
    <fieldset>



      <input class="hidden" type="checkbox" value="1" th:field="*{authorities}" />
      <input class="hidden" type="checkbox" value="2" th:field="*{authorities}" />
      <input class="hidden" type="checkbox" value="3" th:field="*{authorities}" />
      <input class="hidden" type="checkbox" value="4" th:field="*{authorities}" />
    </fieldset>


    <div>
      <button class="btn btn-primary mt-4" type="submit">
        <h7 th:text="#{save}"></h7>
      </button>

      <a
              th:href="@{/}" class="btn btn-secondary mt-4">
        <h7 th:text="#{cancel}"></h7>
      </a>




      <!--script>
          var f = document.getElementsByName('authority');
          var v ='';
          for(var i = 0; i < f.length; i++){
              if(f[i].checked){
                  v = v+' '+ f[i].value;
              }
          }
          if (v=='') {v="Nie dokonałeś żadnego wyboru.";}
          alert(v);
      </script-->
    </div>
  </form>
</div>
</body>
</html>